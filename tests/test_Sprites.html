<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Test Sprites</title>
  <script>
  // configure curl
    curl = {
      apiName: 'require',
      baseUrl: '../lib',
      pluginPath: '../lib/amd',
      paths: {
        curl: 'curl/src/curl',
        tests: '../tests'
      }
    };
  </script>
  <script src="../lib/curl/src/curl.js"></script>
  <script>
  // configure curl
    curl = {
      apiName: 'require',
      baseUrl: './lib',
      pluginPath: '../lib/amd',
      paths: {
        curl: 'curl/src/curl',
        tests: '../tests'
      }
    };
  </script>
  <script>
    var now = +new Date;
    require([
      'lang',
      'dom',
      'sprite',
      'entity',
      'image!../resources/charsets.png'
    ], function(lang, dom, Sprite, Entity, spriteSheet){
      console.log("require callback: ", spriteSheet);
      
      var commonState = { img: spriteSheet, w: 16, h: 18, offsetx: 0, frames: 3 };
      var playerSprite = new Sprite({
        name: 'playerSprite',
        state: {
          walkright: lang.mixin(Object.create(commonState), {
            name: 'walkright', offsety: 180, interval: 30
          })
        }
      });
      var ent = window.player = new Entity("playerSprite", {
        name: 'player',
        x: 10, y: 50, width: 16, height: 18,
        render: function(){
    			var canvas = document.getElementById('stage'),
    				ctx = canvas.getContext("2d");
    				ctx.clearRect( 0, 0, canvas.width, canvas.height );
    				
    			var ent = this, 
    			    sprite = this.sprite, 
    			    animFrame = this.spriteFrame;
    			var drawArgs = [	  
    			    sprite.img, 
      			  sprite.offsetx + (animFrame * sprite.w),
      			  sprite.offsety,
      			  sprite.w,
      			  sprite.h,
      			  ent.x,ent.y,ent.width,ent.height
      		];
      		console.log("image,srcX,srcY,srcW,srcH,destX,destY,destW,destH");
      		console.log(drawArgs);
    			ctx.drawImage.apply(ctx, drawArgs);
        }
      });
      
      ent.init();
    }); 
    
    function moveRight(){
      player.spriteState = 'walkright';
      player.x += 2;
      player.update();
      console.log("frame: "+ player.spriteFrame);
      player.render();
    }
    function moveLeft(){
      player.spriteState = 'walkleft';
      player.x -= 2;
      player.update();
      console.log("frame: "+ player.spriteFrame);
      player.render();
    }
  </script>
</head>

<body>

  <canvas id="stage" width="800" height="400"></canvas>

</body>
</html>
